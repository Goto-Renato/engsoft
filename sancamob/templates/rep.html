{%load static%}
<!DOCTYPE html>
<html>
 <head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script type = "text/javascript" src = "https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
  <style>
		#map {
		margin-top: 2%;
		float: left;
		width: 100%;
		height: 500px;
		background-color: grey;
		}
		#detalhes {
		display: inline;
		float: right;
		width: 49%;
		height: 400px;
		background-color: grey;
		}
		#semLatLong .imovel {
		border-color: gray;
		border-style: solid;
		border-width: thin;
		}
		#semLatLong{
		margin: 0px;
		padding: 0px;
		}
  </style>

 </head>

<body>
<nav class="red darken-3" role="navigation">
    <div class="nav-wrapper container"><a id="logo-container" href="index.html" class="brand-logo">Logo</a>
      <ul class="right hide-on-med-and-down">
        <li><a href="index.html">Home</a></li>
        <li><a href="moradias.html">Moradias</a></li>
        <li><a href="teoria.html">Tutores</a></li>
        <li><a href="singin.html">Singin/Singup</a></li>
        <li><a href="about.html">About</a></li>
      </ul>

      <ul id="nav-mobile" class="side-nav">
        <li><a href="index.html">Home</a></li>
        <li><a href="moradias.html">Moradias</a></li>
        <li><a href="teoria.html">Tutores</a></li>
        <li><a href="singin.html">Singin/Singup</a></li>
        <li><a href="about.html">About</a></li>
      </ul>
      <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
    </div>
  </nav>

    <div class="container col s12 m12 l12" style="margin-top: -45px">
        <div class="row">
            <div class="col s12 m12 l6">
                <article class="carousel">
                    <a class="carousel-item" style="width: 300px" href="#one!"><img src="{{rep.fotos.url}}"></a>
                    <a class="carousel-item" style="width: 300px" href="#one!"><img src="{{rep.fotos.url}}"></a>
                    <a class="carousel-item" style="width: 300px" href="#one!"><img src="{{rep.fotos.url}}"></a>
                    <a class="carousel-item" style="width: 300px" href="#one!"><img src="{{rep.fotos.url}}"></a>
                </article>
            </div>

            <div class="col s12 m12 l6">
                <div id="map"></div>
            </div>

            <article style="width: 500px">
                <p class="col m6 l6" style="margin-top: 0px">Nome: {{rep.nome}}</p>
                <p class="col m6 l3" style="margin-top: 0px">Vagas: {{rep.vagas}}</p>
                <p class="col m6 l3" style="margin-top: 0px">Valor: {{rep.valor}}</p>
                <p class="col m6 l4" style="margin-top: 0px">Mobiliado: {{rep.mobiliado}}</p>
                <p class="col m6 l4" style="margin-top: 0px">Seguranca: {{rep.seguranca}}</p>
                <p class="col m6 l4" style="margin-top: 0px">Garagem: {{rep.garagem}}</p>
                <p class="col m6 l6" style="margin-top: 0px">Entrada Mais proxima: {{rep.entrada_prox}}</p>
                <p class="col m6 l6" style="margin-top: 0px">Contato: {{rep.contato}}</p>
                <p class="col m6 l12" style="margin-top: 0px">Endereco: {{rep.endereco}}</p>
                <p class="col m6 l12" style="margin-top: 0px">Descriçao: {{rep.descricao}}</p>
            </article>

        </div>


        <!--mapa-->

    </div>

    <script>
		initMap = () => {
			const saoCarlos = {lat: -22.009772, lng: -47.890803};
			const map = new google.maps.Map(document.getElementById('map'), {zoom: 13, center: saoCarlos});
			const marker = new google.maps.Marker({position: {lat: -22.0060699, lng: -47.897604}, map: map});
			fetch('/home/bruno/Documentos/scrapper/rocaScrapper/rocaImoveis.json')
			  .then(response => response.json())
			  .then(imoveis => {console.log(imoveis);
				let texto = "";
				for(i in imoveis){
					let lat = parseFloat(imoveis[i].lat);
					let long = parseFloat(imoveis[i].long);
					if(Number.isNaN(lat) || Number.isNaN(long)) console.log(imoveis[i].link);
					if(lat != 0 && long != 0 && !Number.isNaN(lat) && !Number.isNaN(long)){
						console.log("imovel " + i + " lat: " + lat + " lng: " + long);
						var markerImovel = new google.maps.Marker({position: {lat: lat, lng: long}, map: map});
					}
					else{
/*						// monta uma lista com mais detalhes, TODO pegar o bairro do imóvel também
						texto += "<li class='imovel' onclick=\"mostrarDetalhes('" + imoveis[i].link + "')\">";
						texto += "<h5>" + imoveis[i].descricao + "</h5>";
						texto += "<h5>R$ " + imoveis[i].preco + "</h5>";
						texto += "<h6>Tipo: " + imoveis[i].tipo;
						texto += ", Área: " + imoveis[i].area + "m²";
						texto += ", Banheiros: " + imoveis[i].banheiros;
						texto += ", Quartos: " + imoveis[i].quartos;
						texto += ", Vagas de garagem: " + imoveis[i].garagens;
						texto += "</li>";*/
						// monta uma lista com menos detalhes
						texto += "<li onClick=\"mostrarDetalhes('" + imoveis[i].link + "')\">" + imoveis[i].link.split("/")[4].replace(/-/g, " ") + "</li>";
					}
				}
				document.getElementById("semLatLong").innerHTML = texto;
			});
		};
		const mostrarDetalhes = (link) => {
			document.getElementById("detalhes").setAttribute("src", link);
		};
	</script>

	<script async defer src="https://maps.googleapis.com/maps/api/js?&v=3.32&callback=initMap"></script>

    <script>
    $(document).ready(function(){
          $('.carousel').carousel();
        });
    </script>
    <!--  Scripts-->

    <script src="{% static 'assets/js/materialize.js' %}"></script>
    <script src="{% static 'assets/js/init.js' %}"></script>

    </body>
</html>
